article.article,
article.article * {
  @apply scroll-m-20 break-words;
}

/* default */
article.article {
  p {
    @apply my-4;
  }
  a {
    @apply font-normal;
  }
  figure,
  blockquote {
    @apply my-6 font-normal;
  }
}

/* compact */
article.article-compact {
  p {
    @apply my-2;
  }
  a {
    @apply font-normal;
  }
  figure,
  blockquote {
    @apply my-3 font-normal;
  }
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    @apply mt-2;
  }
}

/* --- Override prose --- */

.article {
  :where(blockquote p:first-of-type):before,
  :where(blockquote p:last-of-type):after {
    @apply content-[''];
  }
  :where(code)::before,
  :where(code)::after {
    @apply content-[''];
  }
}

/* --- */

.article-compact.article * {
  @apply scroll-m-0;
}

.article-compact {
  @apply p-0;

  & > *:first-child {
    @apply mt-0;
  }

  & > *:last-child {
    @apply mb-0;
  }

  :where(pre) {
    @apply mb-0;
  }

  :where(h1) {
    @apply mb-0;
  }

  :where(h2) {
    @apply mb-0;
  }

  :where(h3) {
    @apply mb-0;
  }

  :where(h4) {
    @apply mb-0;
  }

  :where(img) {
    @apply my-0;
  }

  :where(pre) {
    @apply my-0;
  }
}

nav.toc {
  @apply prose m-0 p-0;
}

nav.toc ol {
  @apply !m-0 !p-0 !pl-2;
}

nav.toc li {
  @apply list-disc list-inside leading-relaxed;
}

nav.toc a {
  @apply text-layer-content/80 no-underline hover:underline;
}

article.article pre,
article.article pre * {
  @apply text-base break-words;
}

article.article pre {
  @apply bg-layer-content/5 text-layer-content backdrop-blur-sm rounded-md !mx-0 !min-w-0 !text-wrap;
}

article.article pre > code {
  @apply flex flex-col break-all;
}

code:not(pre code) {
  @apply !text-[1em] !break-words !bg-layer-content/10 rounded-xs !mx-1 !px-1 !font-normal;
}

pre code {
  counter-reset: line;
}

pre code > button {
  @apply cursor-pointer;
}

pre code > [data-line] {
  @apply before:w-[1.8em] pl-[2.8em] relative;
}

/* pre code:has([data-line]:nth-child(10)) > [data-line] {
  @apply before:w-[1.8em] pl-[2.8em];
} */

pre code:has([data-line]:nth-child(100)) > [data-line] {
  @apply before:w-[2.4em] pl-[3.4em];
}

pre code:has([data-line]:nth-child(1000)) > [data-line] {
  @apply before:w-[3em] pl-[4em];
}

pre code > [data-line]::before {
  counter-increment: line;
  content: counter(line) !important;

  @apply absolute left-0 top-0 float-start inline-block text-layer-content/60 pr-2 text-right whitespace-nowrap mr-4 h-full border-r-2 border-layer-content/10;
}

pre code > [data-highlighted-line] {
  @apply bg-layer-content/10 rounded-md;
}

pre button.rehype-pretty-copy {
  @apply !absolute !top-2 !right-2;
  @apply !w-8 !h-8 flex items-center justify-center;
  @apply text-success;

  span.ready {
    @apply icon-[fluent--copy-20-regular] w-5 h-5;
  }

  span.success {
    @apply hidden icon-[fluent--checkmark-20-regular] w-5 h-5;
  }
}

html[data-style="dark"] {
  code[data-theme*=" "],
  code[data-theme*=" "] span {
    color: var(--shiki-dark);
  }
}

html[data-style="light"] {
  code[data-theme*=" "],
  code[data-theme*=" "] span {
    color: var(--shiki-light);
  }
}

article.article img {
  @apply !rounded-sm;
}

article > *:first-child {
  @apply mt-6;
}

article > h1 > a,
article > h2 > a,
article > h3 > a,
article > h4 > a,
article > h5 > a,
article > h6 > a {
  @apply !no-underline;
}

article > h1 > a,
article > h2 > a {
  @apply !font-bold;
}

article > h3 > a,
article > h4 > a {
  @apply !font-semibold;
}

article > h1 > a:hover::after,
article > h2 > a:hover::after,
article > h3 > a:hover::after,
article > h4 > a:hover::after,
article > h5 > a:hover::after,
article > h6 > a:hover::after {
  content: "Â¶";
  @apply text-primary opacity-60 ml-4;
}

article a:not(h1 > a, h2 > a, h3 > a, h4 > a, h5 > a, h6 > a) {
  @apply text-primary !no-underline hover:!underline;
}

article blockquote {
  --quote-color: rgb(156 163 175);
  --quote-bg: rgb(156 163 175 / 0.1);
  &.markdown-alert {
    &.markdown-alert-blue {
      --quote-color: var(--color-info);
      --quote-bg: --alpha(var(--color-info) / 0.1);
    }
    &.markdown-alert-green {
      --quote-color: var(--color-success);
      --quote-bg: --alpha(var(--color-success) / 0.1);
    }

    &.markdown-alert-yellow {
      --quote-color: var(--color-warning);
      --quote-bg: --alpha(var(--color-warning) / 0.1);
    }

    &.markdown-alert-magenta {
      --quote-color: var(--color-violet-500);
      --quote-bg: --alpha(var(--color-violet-500) / 0.1);
    }

    &.markdown-alert-red {
      --quote-color: var(--color-error);
      --quote-bg: --alpha(var(--color-error) / 0.1);
    }
  }
}

article blockquote {
  border-left-color: var(--quote-color) !important;
  background-color: var(--quote-bg) !important;

  @apply !not-italic text-layer-content/80 border-l-[5px] rounded-sm !px-4 !py-3 !mx-0 backdrop-blur-xs;

  & figure,
  & pre {
    @apply !m-0;
  }

  & p {
    @apply !mx-0 !my-2;
  }

  &.markdown-alert[data-alert-title] > p:first-child {
    color: var(--quote-color);
    font-weight: 600;
  }

  & > *:first-child {
    @apply !mt-0;
    @apply before:!content-[''] after:!content-[''];
  }

  & > * {
    @apply !mx-0;
  }

  & > *:last-child {
    @apply !mb-0;
  }

  /* & pre code {
    @apply not-italic;
  } */
}

@layer components {
  .article {
    @apply prose prose-zinc px-3 lg:px-6 print:px-12 print:pb-12;
  }

  :root[data-style="dark"] .article {
    @apply prose-invert;
  }
}
